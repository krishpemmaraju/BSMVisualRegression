# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: Validate Add product to basket layout and Validate Auto populate fields
- Location: C:\Automation\AutomationNewSVN\AutoMisc\visualregression\tests\OrderCaptureTestsVisualRegression_NewUI.spec.ts:205:5

# Error details

```
TimeoutError: locator.waitFor: Timeout 9000ms exceeded.
Call log:
  - waiting for getByRole('button', { name: 'Add' }) to be visible

    at C:\Automation\AutomationNewSVN\AutoMisc\visualregression\tests\OrderCaptureTestsVisualRegression_NewUI.spec.ts:207:53
```

# Test source

```ts
  107 |     const isAvailableBalanceVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Available Balance']");
  108 |     const isAvailableBalancePanelAvailable = page.locator("oj-sp-general-drawer-template[drawer-title='Transaction History']");
  109 |     const isAvailableBalanceHeadingAvailable = page.locator("div[title='Transaction History']")
  110 |     const closeBtn = page.locator("button[aria-label='Close']")
  111 |
  112 |     await expect(isAvailableBalanceVisible).toBeVisible();
  113 |     await isAvailableBalanceVisible.click()
  114 |     await expect(isAvailableBalancePanelAvailable).toBeVisible();
  115 |     await expect(isAvailableBalanceHeadingAvailable).toHaveText('Transaction History')
  116 |     await closeBtn.scrollIntoViewIfNeeded();
  117 |     await closeBtn.click({force: true});
  118 | })
  119 |
  120 | test("Validate Required Section", async() => {
  121 |         const isRequiredVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Required']");
  122 |         
  123 |         await expect(isRequiredVisible).toBeVisible();
  124 | })
  125 |
  126 |
  127 | test("Validate Customer PO section info Slot", async () => {
  128 |   const customerPOTextAvailable = page.locator("span[title='Customer PO #']");
  129 |   const customerPOContentSlotSelection = page.locator("oj-sp-scoreboard-metric-card[card-title='Customer PO #']");
  130 |   const customerPOPanelAvailable =  page.locator("oj-sp-general-drawer-template[drawer-title='Order Details']");
  131 |   const isCustomerPOHeadingAvailable = page.locator("div[title='Order Details']")
  132 |   const customerOrderInputTextAvailable = page.getByLabel("Customer Order Number")
  133 |   const isCustomerOrderNumberTextBoxAvailable = page.locator("oj-c-input-text[label-hint='Customer Order Number'] input");
  134 |   const isCancelBtnAvailableUnderCustPOSection = page.getByRole('button', {name:'Cancel'})
  135 |   const isContinueBtnAvailableUnderCustPOSection = page.getByRole('button', {name:'Continue'})
  136 |   const closeBtn = page.locator("button[aria-label='Close']")
  137 |
  138 |   await expect(customerPOTextAvailable).toHaveText("Customer PO #")
  139 |   await expect(customerPOContentSlotSelection).toBeEnabled();
  140 |   await expect(customerPOContentSlotSelection).toHaveScreenshot(["OrderCapture/CustomerPOContentSlot", "CustomerPOContentSlotClickable.png"])
  141 |   await customerPOContentSlotSelection.click();
  142 |   await expect(customerPOPanelAvailable).toBeVisible()
  143 |   expect(await isCustomerPOHeadingAvailable.textContent()).toContain("Order Details")
  144 |   await expect(customerOrderInputTextAvailable).toBeVisible();
  145 |   await expect(isCustomerOrderNumberTextBoxAvailable).toBeVisible();
  146 |   await expect(isCustomerOrderNumberTextBoxAvailable).toBeEnabled();
  147 |   await expect(isCancelBtnAvailableUnderCustPOSection).toBeVisible();
  148 |   await expect(isCancelBtnAvailableUnderCustPOSection).toBeEnabled();
  149 |   await expect(isContinueBtnAvailableUnderCustPOSection).toBeVisible();
  150 |   await expect(isContinueBtnAvailableUnderCustPOSection).toBeEnabled();
  151 |   await closeBtn.scrollIntoViewIfNeeded();
  152 |   await closeBtn.click({force: true});
  153 |
  154 | })
  155 |
  156 | test("Validate Loyalty Program Section", async() => {
  157 |     const isLoyaltyProgramTextVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Loyalty Program']");
  158 |     await expect(isLoyaltyProgramTextVisible).toBeVisible();
  159 | })
  160 |
  161 |
  162 |
  163 | test("Validate Product Details page", async()=> {
  164 |     await page.locator("input[aria-label='Product Search']").waitFor({timeout: 6000});
  165 |     await page.locator("input[aria-label='Product Search']").fill("219500")
  166 |     await page.locator("#searchInputContainer_tbProductSearch").click()
  167 |     await page.locator("wol-product-card[id*='219500']").click();
  168 |     const getQuantityLabel = page.getByLabel("Quantity");
  169 |     const addBtnOnProdDetailsPage = page.getByRole('button',{name:'Add to Basket'});
  170 |     const productDetailsText = page.locator("div.oj-flex.oj-sm-flex-direction-column   div.oj-typography-body-md.oj-flex-item.oj-sm-flex-initial");
  171 |     const getAlternateProductLink = page.locator("div.oj-collapsible-header-wrapper").nth(0);
  172 |     const getRelatedProducts = page.locator("div.oj-collapsible-header-wrapper").nth(1);
  173 |     await expect(getAlternateProductLink).toHaveText("Alternate Products");
  174 |     await expect(getRelatedProducts).toHaveText("Related Products");
  175 |     await page.locator("button[aria-label='Back']").click()
  176 | })
  177 |
  178 |
  179 |
  180 | test("Validate Add button on Product Search Page section", async () => {
  181 |     // await page.locator("input[aria-label='Product Search']").waitFor({timeout:5000})
  182 |     // await page.locator("input[aria-label='Product Search']").fill('');
  183 |     // await page.locator("input[aria-label='Product Search']").fill("D53216")
  184 |     const isAtpDateVisible = page.locator('span.oj-flex-item.oj-badge.custom-badge-atp');
  185 |     const isAvailableStockVisible = page.locator('span.oj-badge.oj-badge-sm.custom-badge');
  186 |     const productSearchAddBtn = page.locator("button[aria-label='Add']")
  187 |     await productSearchAddBtn.scrollIntoViewIfNeeded()
  188 |     await productSearchAddBtn.waitFor({state:'visible',timeout: 8000});
  189 |     await expect(productSearchAddBtn).toBeVisible({timeout:8000})
  190 |     await expect(isAtpDateVisible).toBeVisible();
  191 |     await expect(isAvailableStockVisible).toBeVisible();
  192 |     await expect(page.locator('wol-stock-quantity.oj-complete')).toHaveCount(1);
  193 | })
  194 |
  195 | // test("Validate Add product to basket section", async ({ page }) => {
  196 | //     await page.locator("input[aria-label='Product Search']").fill("219500")
  197 | //     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  198 | //     await productSearchAddBtn.click()
  199 | //     await page.waitForSelector("[class*='oj-listview-item']", { state: 'visible', timeout: 15000 })
  200 | //     const productSelAddToBsktList = page.locator("[class='oj-listview-cell-element']")
  201 | //     await expect(productSelAddToBsktList).toBeVisible()
  202 | //     await expect(productSelAddToBsktList).toHaveScreenshot(["OrderCapture/AddToProductBasketSlotSection", "AddToProductBasketSlotSection.png"])
  203 | // })
  204 |
  205 | test("Validate Add product to basket layout and Validate Auto populate fields", async () => {
  206 |     // await page.locator("input[aria-label='Product Search']").fill("D53216")
> 207 |     await page.getByRole('button', { name: 'Add' }).waitFor({ state: 'visible', timeout: 9000 })
      |                                                     ^ TimeoutError: locator.waitFor: Timeout 9000ms exceeded.
  208 |     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  209 |     await productSearchAddBtn.click()
  210 |     await page.waitForSelector("[class*='oj-listview-item']", { state: 'visible', timeout: 15000 })
  211 |     await expect(page.getByRole('button',{name:'Save'})).toBeVisible();
  212 |     const isCustomerAutoPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Customer'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  213 |     expect(isCustomerAutoPopulated).not.toBeNull();
  214 |     // const isBillToAutoPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Bill to'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  215 |     // expect(isBillToAutoPopulated).not.toBeNull();
  216 |     const isRequiredPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Required'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  217 |     expect(isRequiredPopulated).not.toBeNull();
  218 |     // const isShippingMethodPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Shipping Method'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  219 |     // expect(isShippingMethodPopulated).not.toBeNull();
  220 |     const isClearAllVisible = await page.getByRole('button',{name: 'Clear All'});
  221 |     expect(isClearAllVisible).toBeVisible()
  222 |     const productSelAddToBsktList = page.locator("[class='oj-listview-cell-element']")
  223 |     await expect(productSelAddToBsktList).toBeVisible()
  224 |     const addToBsktDecreaseBtn = page.locator("div.oj-listview-cell-element button[aria-label='Decrease']")
  225 |     const addToBsktIncreaseBtn = page.locator("div.oj-listview-cell-element button[aria-label='Increase']")
  226 |     const addToBsktDeleteBtn = page.locator("button[aria-label='Delete']")
  227 |     const isSubTotalDisplayed =  page.getByText('Sub Total');
  228 |     const isVATDisplayed =  page.getByText('VAT');
  229 |     const isTotalDisplayed =  page.getByText('Total',{exact: true});
  230 |     await expect(isSubTotalDisplayed).toBeVisible();
  231 |     await expect(isVATDisplayed).toBeVisible();
  232 |     await expect(isTotalDisplayed).toBeVisible();
  233 |     await expect(addToBsktDecreaseBtn).toBeVisible();
  234 |     await expect(addToBsktIncreaseBtn).toBeVisible();
  235 |     await expect(addToBsktDeleteBtn).toBeVisible();
  236 | })
  237 |
  238 | test("Validate Detail Slot (Add Basket Section) in Order Capture Page", async () => {
  239 |     const detailSlotSection = page.locator("oj-vb-fragment-slot[name='detail']")
  240 |     await expect(detailSlotSection).toHaveScreenshot(["OrderCapture/DetailSlotSection", "DetailSlotSectionOnOrderCapturePage.png"])
  241 | })
  242 |
  243 |
  244 | // test("Validate Order Dialog pop up with Print and Edit Options", async ({ page }) => {
  245 | //     await page.locator("input[aria-label='Product Search']").fill("D53216")
  246 | //     await page.getByRole('button', { name: 'Add' }).waitFor({ state: 'visible', timeout: 15000 })
  247 | //     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  248 | //     await productSearchAddBtn.click()
  249 | //     await page.waitForSelector("div[class='oj-listview-cell-element']", { state: 'visible', timeout: 16000 })
  250 | //     const productSelAddToBsktList = page.locator("div[class='oj-listview-cell-element']")
  251 | //     await expect(productSelAddToBsktList).toBeVisible({ timeout: 12000 });
  252 | //     const clickOnSubmitBtn = page.getByRole('button', { name: 'Submit' });
  253 | //     await clickOnSubmitBtn.click({ force: true });
  254 | //     await page.getByRole('heading', { name: 'Checkout', exact: true }).waitFor({ state: 'visible' });
  255 |
  256 | //     const waitForPickingNoteHeaderText = page.locator("//span[text()='Print picking note']");
  257 | //     const waitForEditBsktItemChk = page.locator("//span[text()='Have you picked ALL stock items?']");
  258 | //     await expect(waitForPickingNoteHeaderText).toBeVisible();
  259 | //     await expect(waitForEditBsktItemChk).toBeVisible();
  260 | //     const isPrintBtnAvailableOnOrderDialog = page.getByRole('button',{name:'Print'});
  261 | //     await expect(isPrintBtnAvailableOnOrderDialog).toBeVisible();
  262 | //     const isEditBtnAvailableOnOrderDialog = page.getByRole('button').filter({hasText:'Edit'});
  263 | //     await expect(isEditBtnAvailableOnOrderDialog).toBeVisible();
  264 | //     (await page.waitForSelector("//button[text()='Confirm']")).waitForElementState('enabled');
  265 | //     await page.locator("//button[text()='Confirm']").click({timeout:5000});
  266 | //     expect(await page.locator("#oj_gop1_h_pageTitle").textContent()).toMatchSnapshot(["OrderCapture/OrderConfirmation", "OrderConfirmationHeader.txt"]);
  267 | // })
  268 |
  269 | // test.skip("Validate Extended button under Detail Slot section", async ({ page }) => {
  270 | //     const extendedBtnOnDetailSlot = page.getByRole('button', { name: 'Extended' })
  271 | //     await expect(extendedBtnOnDetailSlot).toHaveScreenshot(["OrderCapture/DetailSlotSection", "ExtendedBtnDetailSlotSectionOnOrderCapturePage.png"])
  272 | // })
  273 |
  274 |
```