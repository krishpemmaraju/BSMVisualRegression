# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: Validate Loyalty Program Section
- Location: C:\Automation\AutomationNewSVN\AutoMisc\visualregression\tests\OrderCaptureTestsVisualRegression_NewUI.spec.ts:147:5

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: locator('oj-sp-scoreboard-metric-card[card-title=\'Loyatly Program\']')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for locator('oj-sp-scoreboard-metric-card[card-title=\'Loyatly Program\']')

    at C:\Automation\AutomationNewSVN\AutoMisc\visualregression\tests\OrderCaptureTestsVisualRegression_NewUI.spec.ts:149:47
```

# Test source

```ts
   49 |   const getSearchBarElement = page.getByRole('textbox', { name: 'Product Search' })
   50 |   await getSearchBarElement.click();
   51 |   const gridView = page.locator("span[role='toolbar']").filter({ has: page.getByLabel('Grid View') })
   52 |   await expect(gridView).toHaveScreenshot(["OrderCapture/ContentSlotSection", "GridViewButtonOnContentSlotSection.png"])
   53 | })
   54 |
   55 | test("Validate Select Customer section info Slot", async () => {
   56 |   const customerTextAvailable = page.locator("span[title='Customer']");
   57 |   const selectCustomerText = page.locator("div[title='Select Customer...']");
   58 |   const clickToSelectCustomer = page.locator("span[title='Click to select a customer']");
   59 |   const customerContentSlotSelection = page.locator("oj-sp-scoreboard-metric-card[card-title='Customer']");
   60 |   const searchInputAvailableAfterClickCustomer = page.locator("oj-sp-general-drawer-template[drawer-title='Customer Details']");
   61 |   const getTextOfCustomerDetailsSection = page.locator("div[title='Customer Details']")
   62 |   const customerSearchInputAvailable = page.locator("input[aria-label='Customer Search']");
   63 |   const customerSearchResultsAvailable = page.locator('oj-c-list-view.customer-list');
   64 |   const selectCustomerListed = page.getByText('SMITH AND BYFORD LTD')
   65 |   const isSelectedCustomerVisible = page.locator("div[title='SMITH AND BYFORD LTD']")
   66 |
   67 |   await expect(customerContentSlotSelection).toBeEnabled();
   68 |   await expect(customerContentSlotSelection).toHaveScreenshot(["OrderCapture/CustomerContentSlot", "CustomerContentSlotClickable.png"])
   69 |   await expect(customerTextAvailable).toHaveText("Customer")
   70 |   await expect(selectCustomerText).toHaveText("Select Customer...")
   71 |   await expect(clickToSelectCustomer).toHaveText("Click to select a customer")
   72 |   await customerContentSlotSelection.click()
   73 |   await expect(searchInputAvailableAfterClickCustomer).toHaveScreenshot(["OrderCapture/CustomerContentSlot", "CustomerDetailsPanel.png"])
   74 |   await expect(getTextOfCustomerDetailsSection).toHaveText('Customer Details');
   75 |   await expect(customerSearchInputAvailable).toBeVisible({timeout:10000});
   76 |   await expect(customerSearchInputAvailable).toBeEnabled();
   77 |   await customerSearchInputAvailable.fill('SMITH AND BYFORD LTD')
   78 |   await expect(customerSearchResultsAvailable).toBeVisible();
   79 |   await selectCustomerListed.click();
   80 |   await expect(isSelectedCustomerVisible).toBeVisible();
   81 | })
   82 |
   83 | test("Validate Account Status Section", async () => {
   84 |     const isAccountStatusVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Account Status']");
   85 |     const isAccountStatusPanelAvailable = page.locator("oj-sp-general-drawer-template[drawer-title='Account Status']");
   86 |     const isAccoutnStatusHeadingAvailable = page.locator("div[title='Account Status']")
   87 |
   88 |
   89 |     await expect(isAccountStatusVisible).toBeVisible();
   90 |     await isAccountStatusVisible.click();
   91 |     await expect(isAccountStatusPanelAvailable).toBeVisible();
   92 |     await expect(isAccoutnStatusHeadingAvailable).toHaveText('Account Status');
   93 |     await page.locator("button[aria-label='Close']").scrollIntoViewIfNeeded();
   94 |     console.log(await page.locator("button[aria-label='Close']").isVisible({timeout:8000}))
   95 |     await page.locator("button[aria-label='Close']").click({force: true});
   96 | })
   97 |
   98 | test("Validate Available Balance Section", async() => {
   99 |     const isAvailableBalanceVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Available Balance']");
  100 |     const isAvailableBalancePanelAvailable = page.locator("oj-sp-general-drawer-template[drawer-title='Transaction History']");
  101 |     const isAvailableBalanceHeadingAvailable = page.locator("div[title='Transaction History']")
  102 |     const closeBtn = page.locator("button[aria-label='Close']")
  103 |
  104 |     await expect(isAvailableBalanceVisible).toBeVisible();
  105 |     await isAvailableBalanceVisible.click()
  106 |     await expect(isAvailableBalancePanelAvailable).toBeVisible();
  107 |     await expect(isAvailableBalanceHeadingAvailable).toHaveText('Transaction History')
  108 |     await closeBtn.click({force: true});
  109 | })
  110 |
  111 | test("Validate Required Section", async() => {
  112 |         const isRequiredVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Required']");
  113 |         
  114 |         await expect(isRequiredVisible).toBeVisible();
  115 | })
  116 |
  117 |
  118 | test("Validate Customer PO section info Slot", async () => {
  119 |   const customerPOTextAvailable = page.locator("span[title='Customer PO #']");
  120 |   const customerPOContentSlotSelection = page.locator("oj-sp-scoreboard-metric-card[card-title='Customer PO #']");
  121 |   const customerPOPanelAvailable =  page.locator("oj-sp-general-drawer-template[drawer-title='Order Details']");
  122 |   const isCustomerPOHeadingAvailable = page.locator("div[title='Order Details']")
  123 |   const customerOrderInputTextAvailable = page.getByLabel("Customer Order Number")
  124 |   const isCustomerOrderNumberTextBoxAvailable = page.locator("oj-c-input-text[label-hint='Customer Order Number'] input");
  125 |   const isCancelBtnAvailableUnderCustPOSection = page.getByRole('button', {name:'Cancel'})
  126 |   const isContinueBtnAvailableUnderCustPOSection = page.getByRole('button', {name:'Continue'})
  127 |   const closeBtn = page.locator("button[aria-label='Close']")
  128 |
  129 |   await expect(customerPOTextAvailable).toHaveText("Customer PO #")
  130 |   await expect(customerPOContentSlotSelection).toBeEnabled();
  131 |   await expect(customerPOContentSlotSelection).toHaveScreenshot(["OrderCapture/CustomerPOContentSlot", "CustomerPOContentSlotClickable.png"])
  132 |   await customerPOContentSlotSelection.click();
  133 |   await expect(customerPOPanelAvailable).toBeVisible()
  134 |   expect(await isCustomerPOHeadingAvailable.textContent()).toContain("Order Details")
  135 |   await expect(customerOrderInputTextAvailable).toBeVisible();
  136 |   await expect(isCustomerOrderNumberTextBoxAvailable).toBeVisible();
  137 |   await expect(isCustomerOrderNumberTextBoxAvailable).toBeEnabled();
  138 |   await expect(isCancelBtnAvailableUnderCustPOSection).toBeVisible();
  139 |   await expect(isCancelBtnAvailableUnderCustPOSection).toBeEnabled();
  140 |   await expect(isContinueBtnAvailableUnderCustPOSection).toBeVisible();
  141 |   await expect(isContinueBtnAvailableUnderCustPOSection).toBeEnabled();
  142 |     await closeBtn.scrollIntoViewIfNeeded();
  143 |   await closeBtn.click({force: true});
  144 |
  145 | })
  146 |
  147 | test("Validate Loyalty Program Section", async() => {
  148 |     const isLoyaltyProgramTextVisible = page.locator("oj-sp-scoreboard-metric-card[card-title='Loyatly Program']");
> 149 |     await expect(isLoyaltyProgramTextVisible).toBeVisible();
      |                                               ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
  150 | })
  151 |
  152 | test.skip("Validate Product List slot", async () => {
  153 |     await page.locator("input[aria-label='Product Search']").fill("219500")
  154 |     const productSearchSlot = page.getByRole('grid').filter({ has: page.locator("wol-product-card") , timeout: 5000})
  155 |     await expect(productSearchSlot).toBeVisible()
  156 |     await expect(productSearchSlot).toHaveScreenshot(["OrderCapture/ProductListSlotSection", "ProductListContentSlotSection.png"], { maxDiffPixels: 100, maxDiffPixelRatio: 0.02 })
  157 | })
  158 |
  159 | test.skip("Validate Product Details page", async()=> {
  160 |     await page.locator("input[aria-label='Product Search']").fill("219500")
  161 |     await page.locator("wol-product-card[id*='219500']").click();
  162 |     const getQuantityLabel = page.getByLabel("Quantity");
  163 |     const addBtnOnProdDetailsPage = page.getByRole('button',{name:'Add to Basket'});
  164 |     const productDetailsText = page.locator("div.oj-flex.oj-sm-flex-direction-column   div.oj-typography-body-md.oj-flex-item.oj-sm-flex-initial");
  165 |     const getAlternateProductLink = page.locator("div.oj-collapsible-header-wrapper").nth(0);
  166 |     const getRelatedProducts = page.locator("div.oj-collapsible-header-wrapper").nth(1);
  167 |     await expect(getAlternateProductLink).toHaveText("Alternate Products");
  168 |     await expect(getRelatedProducts).toHaveText("Related Products");
  169 | })
  170 |
  171 |
  172 |
  173 | test.skip("Validate Add button on Product Search Page section", async () => {
  174 |   await page.locator("input[aria-label='Product Search']").click();
  175 |     await page.locator("input[aria-label='Product Search']").fill("219500")
  176 |     const isAtpDateVisible = page.locator('span.oj-flex-item.oj-badge.custom-badge-atp');
  177 |     const isAvailableStockVisible = page.locator('span.oj-badge.oj-badge-sm.custom-badge');
  178 |     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  179 |     await expect(isAtpDateVisible).toBeVisible();
  180 |     await expect(isAvailableStockVisible).toBeVisible();
  181 |     await expect(page.locator('wol-stock-quantity.oj-complete')).toHaveCount(1);
  182 |     await expect(productSearchAddBtn).toBeVisible()
  183 | })
  184 |
  185 | // test("Validate Add product to basket section", async ({ page }) => {
  186 | //     await page.locator("input[aria-label='Product Search']").fill("219500")
  187 | //     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  188 | //     await productSearchAddBtn.click()
  189 | //     await page.waitForSelector("[class*='oj-listview-item']", { state: 'visible', timeout: 15000 })
  190 | //     const productSelAddToBsktList = page.locator("[class='oj-listview-cell-element']")
  191 | //     await expect(productSelAddToBsktList).toBeVisible()
  192 | //     await expect(productSelAddToBsktList).toHaveScreenshot(["OrderCapture/AddToProductBasketSlotSection", "AddToProductBasketSlotSection.png"])
  193 | // })
  194 |
  195 | test.skip("Validate Add product to basket layout and Validate Auto populate fields", async () => {
  196 |     await page.locator("input[aria-label='Product Search']").fill("D53216")
  197 |     await page.getByRole('button', { name: 'Add' }).waitFor({ state: 'visible', timeout: 9000 })
  198 |     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  199 |     await productSearchAddBtn.click()
  200 |     await page.waitForSelector("[class*='oj-listview-item']", { state: 'visible', timeout: 15000 })
  201 |     await expect(page.getByRole('button',{name:'Save'})).toBeVisible();
  202 |     const isCustomerAutoPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Customer'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  203 |     expect(isCustomerAutoPopulated).not.toBeNull();
  204 |     const isBillToAutoPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Bill to'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  205 |     expect(isBillToAutoPopulated).not.toBeNull();
  206 |     const isRequiredPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Required'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  207 |     expect(isRequiredPopulated).not.toBeNull();
  208 |     const isShippingMethodPopulated = await page.locator("oj-sp-scoreboard-metric-card[card-title='Shipping Method'] div.oj-sp-scoreboard-metric-card-metric").textContent();
  209 |     expect(isShippingMethodPopulated).not.toBeNull();
  210 |     const isClearAllVisible = await page.getByRole('button',{name: 'Clear All'});
  211 |     expect(isClearAllVisible).toBeVisible()
  212 |     const productSelAddToBsktList = page.locator("[class='oj-listview-cell-element']")
  213 |     await expect(productSelAddToBsktList).toBeVisible()
  214 |     const addToBsktDecreaseBtn = page.locator("div.oj-listview-cell-element button[aria-label='Decrease']")
  215 |     const addToBsktIncreaseBtn = page.locator("div.oj-listview-cell-element button[aria-label='Increase']")
  216 |     const addToBsktDeleteBtn = page.locator("button[aria-label='Delete']")
  217 |     const isSubTotalDisplayed =  page.getByText('Sub Total');
  218 |     const isVATDisplayed =  page.getByText('VAT');
  219 |     const isTotalDisplayed =  page.getByText('Total',{exact: true});
  220 |     await expect(isSubTotalDisplayed).toBeVisible();
  221 |     await expect(isVATDisplayed).toBeVisible();
  222 |     await expect(isTotalDisplayed).toBeVisible();
  223 |     await expect(addToBsktDecreaseBtn).toBeVisible();
  224 |     await expect(addToBsktIncreaseBtn).toBeVisible();
  225 |     await expect(addToBsktDeleteBtn).toBeVisible();
  226 | })
  227 |
  228 | test.skip("Validate Detail Slot (Add Basket Section) in Order Capture Page", async () => {
  229 |     const detailSlotSection = page.locator("oj-vb-fragment-slot[name='detail']")
  230 |     await expect(detailSlotSection).toHaveScreenshot(["OrderCapture/DetailSlotSection", "DetailSlotSectionOnOrderCapturePage.png"])
  231 | })
  232 |
  233 |
  234 | // test("Validate Order Dialog pop up with Print and Edit Options", async ({ page }) => {
  235 | //     await page.locator("input[aria-label='Product Search']").fill("D53216")
  236 | //     await page.getByRole('button', { name: 'Add' }).waitFor({ state: 'visible', timeout: 15000 })
  237 | //     const productSearchAddBtn = page.getByRole('button', { name: 'Add' })
  238 | //     await productSearchAddBtn.click()
  239 | //     await page.waitForSelector("div[class='oj-listview-cell-element']", { state: 'visible', timeout: 16000 })
  240 | //     const productSelAddToBsktList = page.locator("div[class='oj-listview-cell-element']")
  241 | //     await expect(productSelAddToBsktList).toBeVisible({ timeout: 12000 });
  242 | //     const clickOnSubmitBtn = page.getByRole('button', { name: 'Submit' });
  243 | //     await clickOnSubmitBtn.click({ force: true });
  244 | //     await page.getByRole('heading', { name: 'Checkout', exact: true }).waitFor({ state: 'visible' });
  245 |
  246 | //     const waitForPickingNoteHeaderText = page.locator("//span[text()='Print picking note']");
  247 | //     const waitForEditBsktItemChk = page.locator("//span[text()='Have you picked ALL stock items?']");
  248 | //     await expect(waitForPickingNoteHeaderText).toBeVisible();
  249 | //     await expect(waitForEditBsktItemChk).toBeVisible();
```